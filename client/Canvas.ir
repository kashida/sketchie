Convenience wrapper for the html canvas.
::
  // If two values, (width, height).  if one value, (canvas_element).
  // x and y, if provided, specify the logical position of this canvas in
  // document coords.
  canvas_or_w\HTMLCanvasElement|n\$
  h\n\?
  @canvas+\HTMLCanvasElement\
  @ctx+\CanvasRenderingContext2D\
  if h
    @canvas = create('canvas')
    @canvas.width = canvas_or_w
    @canvas.height = h
  else
    @canvas = \HTMLCanvasElement\(canvas_or_w)
  @ctx = @canvas.getContext('2d')
  @scale = 1.0

:clear
  @ctx.clearRect(0, 0, @canvas.width, @canvas.height)

:data_url
  => @canvas.toDataURL()

:set_scale
  scale\n\$
  @scale = scale
  @canvas.width = @canvas.clientWidth / @scale
  @canvas.height = @canvas.clientHeight / @scale

:pixels
  => @ctx.getImageData(0, 0, @canvas.width, @canvas.height)

:copy_image
  img\Image\$
  if !img
    =>
  xform_draw_image(#)
    @ctx
    img
    f_viewport.item_to_surface(elem_position(img))

:duplicate_canvas
  cvs := create('canvas')
  cvs.width = @canvas.width
  cvs.height = @canvas.height
  cvs.getContext('2d').putImageData(@.pixels(), 0, 0)
  => cvs

:copy_canvas
  cvs\HTMLCanvasElement\$
  @ctx.putImageData(cvs.getContext('2d').getImageData(#), 0, 0)
    0
    0
    @canvas.width
    @canvas.height

