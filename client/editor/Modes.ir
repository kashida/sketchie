::
  default_mode\s\$
  @editors\O.<s, editor.Editor>\$
  @modes\A.<s>\ [default_mode]
  @callbacks\A.<F>\ []

Current mode.
:mode+\s\
  assert(@modes.length > 0)
  => @modes[@modes.length - 1]

Currently selected editor.
:editor+\editor.Editor\
  => @editors[@.mode]
  
:changeModeTo
  nextMode\s\$
  // TODO: pass typed obj. caller keep the reference to it and expect
  // return values too so end_mode_params below isn't necessary.
  activate_params\O\? {}
  reactivate_cb\F\?
  assert(nextMode != @.mode)
  @modes.push(nextMode)
  @callbacks.push(reactivate_cb)
  @.editor.activate(activate_params)

:popMode
  end_mode_params\O\? {}
  @.editor.deactivate()
  @modes.pop()
  assert(@modes.length > 0)
  cb := @callbacks.pop()
  if cb
    cb(end_mode_params)
